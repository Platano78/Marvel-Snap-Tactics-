<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#ED1D24">
  <meta name="description" content="Marvel Snap AI Companion & Tracker - Track your collection, log matches, and get tactical advice">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SnapPrime">

  <title>Snapapoulous Prime - Marvel Snap Companion</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'marvel-red': '#ED1D24',
            'marvel-blue': '#006EC7',
            'marvel-gold': '#FFC107',
            'marvel-black': '#1A1A1A',
            'marvel-white': '#FFFFFF',
            'series-1': '#6B7280',
            'series-2': '#22C55E',
            'series-3': '#8B5CF6',
            'series-4': '#EAB308',
            'series-5': '#EF4444',
            'spotlight': '#F97316',
          },
          fontFamily: {
            'comic': ['Impact', 'Arial Black', 'sans-serif'],
          },
          boxShadow: {
            'comic': '4px 4px 0px #1A1A1A',
            'comic-sm': '2px 2px 0px #1A1A1A',
          }
        }
      }
    }
  </script>

  <style>
    /* Custom styles */
    * {
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #1A1A1A;
      color: #FFFFFF;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Comic panel border */
    .panel-border {
      border: 3px solid #1A1A1A;
      box-shadow: 4px 4px 0px #1A1A1A;
    }

    /* Halftone pattern overlay */
    .halftone {
      background-image: radial-gradient(circle, rgba(0,0,0,0.1) 1px, transparent 1px);
      background-size: 8px 8px;
    }

    /* Card hover effect */
    .card-hover {
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
    }

    .card-hover:active {
      transform: scale(0.98);
    }

    /* Series border colors */
    .series-border-1 { border-color: #6B7280; }
    .series-border-2 { border-color: #22C55E; }
    .series-border-3 { border-color: #8B5CF6; }
    .series-border-4 { border-color: #EAB308; }
    .series-border-5 { border-color: #EF4444; }
    .series-border-spotlight { border-color: #F97316; }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #2D2D2D;
    }

    ::-webkit-scrollbar-thumb {
      background: #ED1D24;
      border-radius: 4px;
    }

    /* Tab animation */
    .tab-active {
      position: relative;
    }

    .tab-active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 3px;
      background: #ED1D24;
    }

    /* Input styling */
    input[type="range"] {
      -webkit-appearance: none;
      background: #2D2D2D;
      border-radius: 4px;
      height: 8px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #ED1D24;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #FFC107;
    }

    /* Pulse animation for snap recommendation */
    @keyframes pulse-snap {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .pulse-snap {
      animation: pulse-snap 0.5s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // ==================== CARD DATA ====================
    // Embedded card data for offline functionality
    const CARD_DATA = [
      // Series 1 Cards
      { name: "Abomination", cost: 5, power: 9, series: 1, ability: "No ability." },
      { name: "Ant-Man", cost: 1, power: 1, series: 1, ability: "Ongoing: If your side of this location is full, +3 Power." },
      { name: "America Chavez", cost: 6, power: 9, series: 1, ability: "On Reveal: This always starts in your deck, and is drawn on turn 6." },
      { name: "Angela", cost: 2, power: 0, series: 1, ability: "When you play a card here, +2 Power." },
      { name: "Armor", cost: 2, power: 3, series: 1, ability: "Ongoing: Cards at this location can't be destroyed." },
      { name: "Bishop", cost: 3, power: 1, series: 1, ability: "When you play a card, +1 Power." },
      { name: "Blue Marvel", cost: 5, power: 3, series: 1, ability: "Ongoing: Your other cards have +1 Power." },
      { name: "Cable", cost: 2, power: 2, series: 1, ability: "On Reveal: Draw a card from your opponent's deck." },
      { name: "Captain America", cost: 3, power: 3, series: 1, ability: "Ongoing: Your other cards at this location have +1 Power." },
      { name: "Carnage", cost: 2, power: 2, series: 1, ability: "On Reveal: Destroy your other cards here. +2 Power for each destroyed." },
      { name: "Colossus", cost: 2, power: 3, series: 1, ability: "Ongoing: Can't be destroyed, moved, or have its Power reduced." },
      { name: "Cosmo", cost: 3, power: 3, series: 1, ability: "Ongoing: On Reveal abilities won't happen at this location." },
      { name: "Cyclops", cost: 3, power: 4, series: 1, ability: "No ability." },
      { name: "Deathlok", cost: 3, power: 5, series: 1, ability: "On Reveal: Destroy your other cards at this location." },
      { name: "Elektra", cost: 1, power: 2, series: 1, ability: "On Reveal: Destroy a random enemy 1-Cost card at this location." },
      { name: "Enchantress", cost: 4, power: 5, series: 1, ability: "On Reveal: Remove the abilities from all Ongoing cards at this location." },
      { name: "Forge", cost: 2, power: 1, series: 1, ability: "On Reveal: Give the next card you play +2 Power." },
      { name: "Gamora", cost: 5, power: 7, series: 1, ability: "On Reveal: If your opponent played a card here this turn, +5 Power." },
      { name: "Groot", cost: 3, power: 3, series: 1, ability: "On Reveal: If your opponent played a card here this turn, +3 Power." },
      { name: "Hawkeye", cost: 1, power: 1, series: 1, ability: "On Reveal: If you play a card here next turn, +3 Power." },
      { name: "Hulk", cost: 6, power: 12, series: 1, ability: "No ability." },
      { name: "Human Torch", cost: 1, power: 2, series: 1, ability: "When this moves to a location, double its Power." },
      { name: "Iron Fist", cost: 1, power: 2, series: 1, ability: "On Reveal: After you play your next card, move it one location to the left." },
      { name: "Iron Man", cost: 5, power: 0, series: 1, ability: "Ongoing: Your total Power is doubled at this location." },
      { name: "Jessica Jones", cost: 4, power: 4, series: 1, ability: "On Reveal: If you don't play a card here next turn, +4 Power." },
      { name: "Klaw", cost: 5, power: 4, series: 1, ability: "Ongoing: The location to the right has +6 Power." },
      { name: "Korg", cost: 1, power: 1, series: 1, ability: "On Reveal: Shuffle a Rock into your opponent's deck." },
      { name: "Lady Sif", cost: 3, power: 4, series: 1, ability: "On Reveal: Discard the highest-cost card from your hand." },
      { name: "Lizard", cost: 2, power: 5, series: 1, ability: "Ongoing: -3 Power if your opponent has 4 cards here." },
      { name: "Mantis", cost: 1, power: 2, series: 1, ability: "On Reveal: If your opponent played a card here this turn, draw a card from their deck." },
      { name: "Medusa", cost: 2, power: 2, series: 1, ability: "On Reveal: If this is at the middle location, +3 Power." },
      { name: "Mister Fantastic", cost: 3, power: 2, series: 1, ability: "Ongoing: Adjacent locations have +2 Power." },
      { name: "Mister Sinister", cost: 2, power: 2, series: 1, ability: "On Reveal: Add a Sinister Clone to this location with the same Power." },
      { name: "Moon Girl", cost: 4, power: 4, series: 1, ability: "On Reveal: Duplicate your hand." },
      { name: "Morph", cost: 3, power: 0, series: 1, ability: "On Reveal: Become a copy of a random card in your opponent's hand." },
      { name: "Multiple Man", cost: 2, power: 3, series: 1, ability: "When this moves, add a copy to the old location." },
      { name: "Namor", cost: 4, power: 5, series: 1, ability: "Ongoing: +5 Power if this is your only card here." },
      { name: "Nightcrawler", cost: 1, power: 2, series: 1, ability: "You can move this once." },
      { name: "Nova", cost: 1, power: 1, series: 1, ability: "When this is destroyed, give your cards +1 Power." },
      { name: "Odin", cost: 6, power: 8, series: 1, ability: "On Reveal: Activate the On Reveal abilities of your other cards at this location." },
      { name: "Onslaught", cost: 6, power: 7, series: 1, ability: "Ongoing: Double your other Ongoing effects at this location." },
      { name: "Punisher", cost: 3, power: 2, series: 1, ability: "Ongoing: +1 Power for each enemy card at this location." },
      { name: "Rocket Raccoon", cost: 1, power: 2, series: 1, ability: "On Reveal: If your opponent played a card here this turn, +2 Power." },
      { name: "Scarlet Witch", cost: 2, power: 3, series: 1, ability: "On Reveal: Replace this location with a random location." },
      { name: "Sentinel", cost: 2, power: 3, series: 1, ability: "On Reveal: Add another Sentinel to your hand." },
      { name: "Spectrum", cost: 6, power: 5, series: 1, ability: "On Reveal: Give your Ongoing cards +2 Power." },
      { name: "Spider-Woman", cost: 5, power: 7, series: 1, ability: "On Reveal: Afflict all enemy cards here with -1 Power." },
      { name: "Squirrel Girl", cost: 1, power: 1, series: 1, ability: "On Reveal: Add a 1-Power Squirrel to each other location." },
      { name: "Star-Lord", cost: 2, power: 2, series: 1, ability: "On Reveal: If your opponent played a card here this turn, +3 Power." },
      { name: "Strong Guy", cost: 4, power: 4, series: 1, ability: "Ongoing: If your hand is empty, +6 Power." },
      { name: "Sword Master", cost: 3, power: 6, series: 1, ability: "On Reveal: Discard a card from your hand." },
      { name: "The Thing", cost: 4, power: 6, series: 1, ability: "No ability." },
      { name: "Uatu The Watcher", cost: 1, power: 1, series: 1, ability: "You can see the unrevealed locations." },
      { name: "White Queen", cost: 4, power: 6, series: 1, ability: "On Reveal: Draw a copy of the highest-Cost card in your opponent's hand." },
      { name: "White Tiger", cost: 5, power: 1, series: 1, ability: "On Reveal: Add a 7-Power Tiger to another location." },
      { name: "Wolfsbane", cost: 3, power: 1, series: 1, ability: "On Reveal: +2 Power for each other card you have here." },
      { name: "Wolverine", cost: 2, power: 2, series: 1, ability: "When this is discarded or destroyed, regenerate it at a random location." },
      { name: "Yondu", cost: 1, power: 2, series: 1, ability: "On Reveal: Remove the top card of your opponent's deck." },

      // Series 2 Cards
      { name: "Agent 13", cost: 1, power: 2, series: 2, ability: "On Reveal: Add a random card to your hand." },
      { name: "Bucky Barnes", cost: 2, power: 1, series: 2, ability: "When this is destroyed, create the Winter Soldier in its place." },
      { name: "Cloak", cost: 2, power: 4, series: 2, ability: "On Reveal: Next turn, both players can move cards to this location." },
      { name: "Ebony Maw", cost: 1, power: 7, series: 2, ability: "You can't play cards here after turn 3." },
      { name: "Hobgoblin", cost: 5, power: -8, series: 2, ability: "On Reveal: Switch sides." },
      { name: "Iceman", cost: 1, power: 2, series: 2, ability: "On Reveal: Give a random card in your opponent's hand +1 Cost." },
      { name: "Killmonger", cost: 3, power: 3, series: 2, ability: "On Reveal: Destroy ALL 1-Cost cards." },
      { name: "Leech", cost: 5, power: 3, series: 2, ability: "On Reveal: Remove the abilities from all cards in your opponent's hand." },
      { name: "Morbius", cost: 2, power: 0, series: 2, ability: "Ongoing: +2 Power for each card you've discarded this game." },
      { name: "Nakia", cost: 3, power: 3, series: 2, ability: "On Reveal: Give the 2 leftmost cards in your hand +2 Power." },
      { name: "Okoye", cost: 2, power: 2, series: 2, ability: "On Reveal: Give every card in your deck +1 Power." },
      { name: "Rhino", cost: 3, power: 3, series: 2, ability: "On Reveal: Remove the ability from this location." },
      { name: "Sabretooth", cost: 3, power: 4, series: 2, ability: "When this is destroyed, return it to your hand. It costs 0." },
      { name: "Sandman", cost: 5, power: 4, series: 2, ability: "Ongoing: Players can only play 1 card a turn." },
      { name: "Scorpion", cost: 2, power: 2, series: 2, ability: "On Reveal: Afflict cards in your opponent's hand with -1 Power." },
      { name: "Shang-Chi", cost: 4, power: 3, series: 2, ability: "On Reveal: Destroy all enemy cards at this location that have 9 or more Power." },
      { name: "Shocker", cost: 2, power: 3, series: 2, ability: "No ability." },
      { name: "Storm", cost: 3, power: 2, series: 2, ability: "On Reveal: Flood this location. Next turn it's destroyed." },
      { name: "Sunspot", cost: 1, power: 1, series: 2, ability: "At the end of each turn, gain +1 Power for each unspent Energy." },
      { name: "Swarm", cost: 2, power: 3, series: 2, ability: "When this is discarded, add two 0-cost copies to your hand." },
      { name: "The Collector", cost: 2, power: 2, series: 2, ability: "When a card enters your hand (except from your deck), +1 Power." },
      { name: "The Infinaut", cost: 6, power: 20, series: 2, ability: "If you played a card last turn, you can't play this." },
      { name: "Vulture", cost: 3, power: 3, series: 2, ability: "When a card moves away from here, +5 Power." },
      { name: "Warpath", cost: 4, power: 5, series: 2, ability: "Ongoing: If any of your locations are empty, +4 Power." },

      // Series 3 Cards (Popular ones)
      { name: "Absorbing Man", cost: 4, power: 4, series: 3, ability: "On Reveal: If the last card you played has an On Reveal, copy its ability." },
      { name: "Adam Warlock", cost: 2, power: 0, series: 3, ability: "At the end of each turn, if you're winning this location, draw a card." },
      { name: "Aero", cost: 5, power: 8, series: 3, ability: "On Reveal: Move all enemy cards played this turn to this location." },
      { name: "Agatha Harkness", cost: 6, power: 14, series: 3, ability: "Agatha starts in your hand and plays your cards for you." },
      { name: "Baron Mordo", cost: 2, power: 3, series: 3, ability: "On Reveal: Your opponent draws a card. Set its Cost to 6." },
      { name: "Black Bolt", cost: 5, power: 7, series: 3, ability: "On Reveal: Your opponent discards the lowest-cost card in their hand." },
      { name: "Black Cat", cost: 4, power: 6, series: 3, ability: "If this is in your hand at the end of your turn, discard it." },
      { name: "Black Panther", cost: 5, power: 4, series: 3, ability: "On Reveal: Double this card's Power." },
      { name: "Brood", cost: 3, power: 2, series: 3, ability: "On Reveal: Add 2 Broodlings to this location with the same Power." },
      { name: "Captain Marvel", cost: 5, power: 6, series: 3, ability: "At the end of the game, move to a location that wins you the game." },
      { name: "Cerebro", cost: 3, power: 0, series: 3, ability: "Ongoing: Your highest Power cards get +2 Power." },
      { name: "Colleen Wing", cost: 2, power: 4, series: 3, ability: "On Reveal: Discard the lowest-cost card from your hand." },
      { name: "Crystal", cost: 4, power: 4, series: 3, ability: "On Reveal: If this is at the middle location, shuffle your hand into your deck and draw 3 cards." },
      { name: "Dagger", cost: 2, power: 2, series: 3, ability: "When this moves to a location, +3 Power for each card your opponent has there." },
      { name: "Darkhawk", cost: 4, power: 1, series: 3, ability: "Ongoing: +2 Power for each card in your opponent's deck." },
      { name: "Deadpool", cost: 1, power: 1, series: 3, ability: "When this is destroyed, return it to your hand with double the Power." },
      { name: "Death", cost: 9, power: 12, series: 3, ability: "Costs 1 less for each card destroyed this game." },
      { name: "Destroyer", cost: 6, power: 16, series: 3, ability: "On Reveal: Destroy your other cards." },
      { name: "Doctor Doom", cost: 6, power: 5, series: 3, ability: "On Reveal: Add a 5-Power Doombot to each other location." },
      { name: "Doctor Octopus", cost: 5, power: 10, series: 3, ability: "On Reveal: Pull 4 random cards from your opponent's hand to this location." },
      { name: "Doctor Strange", cost: 3, power: 3, series: 3, ability: "On Reveal: Move your highest-Power card(s) to this location." },
      { name: "Dracula", cost: 4, power: 0, series: 3, ability: "At the end of the game, discard a card from your hand. This has its Power." },
      { name: "Drax", cost: 4, power: 4, series: 3, ability: "On Reveal: If your opponent played a card here this turn, +4 Power." },
      { name: "Electro", cost: 3, power: 2, series: 3, ability: "On Reveal: +1 Max Energy. Ongoing: You can only play 1 card a turn." },
      { name: "Ghost Rider", cost: 4, power: 3, series: 3, ability: "On Reveal: Bring back one of your discarded cards to this location." },
      { name: "Giganto", cost: 6, power: 14, series: 3, ability: "You can only play this at the left location." },
      { name: "Goose", cost: 2, power: 2, series: 3, ability: "Ongoing: No cards that cost 4, 5, or 6 can be played here." },
      { name: "Green Goblin", cost: 3, power: -3, series: 3, ability: "On Reveal: Switch sides." },
      { name: "Hazmat", cost: 2, power: 2, series: 3, ability: "On Reveal: Afflict all other cards with -1 Power." },
      { name: "Hela", cost: 6, power: 6, series: 3, ability: "On Reveal: Play all cards you discarded from your hand to random locations." },
      { name: "Hell Cow", cost: 4, power: 6, series: 3, ability: "On Reveal: Discard 2 cards from your hand." },
      { name: "Heimdall", cost: 6, power: 8, series: 3, ability: "On Reveal: Move your other cards one location to the left." },
      { name: "Hit-Monkey", cost: 3, power: 2, series: 3, ability: "On Reveal: Gain +2 Power for each other card you played this turn." },
      { name: "Invisible Woman", cost: 2, power: 2, series: 3, ability: "Ongoing: Cards you play here are not revealed until the game ends." },
      { name: "Jane Foster", cost: 5, power: 8, series: 3, ability: "On Reveal: Draw all cards that cost 0 from your deck." },
      { name: "Jeff", cost: 2, power: 3, series: 3, ability: "You can move this once. Nothing can stop you from moving or playing this." },
      { name: "Juggernaut", cost: 3, power: 3, series: 3, ability: "On Reveal: If your opponent played cards here this turn, move them randomly." },
      { name: "Kingpin", cost: 3, power: 4, series: 3, ability: "When a card moves here on turn 6, destroy it." },
      { name: "Knull", cost: 6, power: 0, series: 3, ability: "Ongoing: Has the combined Power of all cards destroyed this game." },
      { name: "Leader", cost: 6, power: 4, series: 3, ability: "On Reveal: Copy all cards your opponent played this turn, but on your side." },
      { name: "Legion", cost: 5, power: 7, series: 3, ability: "On Reveal: Replace each other location with this one." },
      { name: "Lockjaw", cost: 3, power: 2, series: 3, ability: "When you play a card here, swap it with a card from your deck." },
      { name: "Luke Cage", cost: 2, power: 1, series: 3, ability: "Ongoing: Your cards can't have their Power reduced." },
      { name: "Magik", cost: 5, power: 3, series: 3, ability: "On Reveal: Change this location to 'Limbo'." },
      { name: "Magneto", cost: 6, power: 12, series: 3, ability: "On Reveal: Move all opposing 3 and 4-Cost cards to this location." },
      { name: "Maria Hill", cost: 2, power: 3, series: 3, ability: "On Reveal: Add a random 1-Cost card to your hand." },
      { name: "Miles Morales", cost: 4, power: 5, series: 3, ability: "If a card moved last turn, this costs 1." },
      { name: "Mirage", cost: 2, power: 2, series: 3, ability: "On Reveal: Copy the lowest-Cost card in your opponent's hand into your hand." },
      { name: "Mojo", cost: 2, power: 2, series: 3, ability: "Ongoing: +6 Power if both players have 4 cards here." },
      { name: "Mole Man", cost: 4, power: 6, series: 3, ability: "On Reveal: Put this and your Rock cards into play at random locations." },
      { name: "Moon Knight", cost: 3, power: 3, series: 3, ability: "On Reveal: Discard a card from each player's hand." },
      { name: "Mystique", cost: 3, power: 0, series: 3, ability: "On Reveal: If the last card you played has an Ongoing ability, this card gains it." },
      { name: "Negasonic Teenage Warhead", cost: 3, power: 4, series: 3, ability: "When ANY card is played here, destroy this card AND that card." },
      { name: "Nick Fury", cost: 5, power: 7, series: 3, ability: "On Reveal: Add 3 random 6-Cost cards to your hand." },
      { name: "Omega Red", cost: 4, power: 5, series: 3, ability: "Ongoing: If you're ahead by 10 Power here, +4 to other locations." },
      { name: "Patriot", cost: 3, power: 1, series: 3, ability: "Ongoing: Your cards with no abilities have +2 Power." },
      { name: "Polaris", cost: 3, power: 5, series: 3, ability: "On Reveal: Move an enemy 1 or 2-Cost card to this location." },
      { name: "Professor X", cost: 5, power: 3, series: 3, ability: "Ongoing: Lock down this location. (Cards can't be added, removed, etc.)" },
      { name: "Psylocke", cost: 2, power: 1, series: 3, ability: "On Reveal: Next turn, +1 Energy." },
      { name: "Quinjet", cost: 1, power: 2, series: 3, ability: "Ongoing: Cards that didn't start in your deck cost 1 less." },
      { name: "Red Skull", cost: 5, power: 13, series: 3, ability: "Ongoing: Enemy cards at this location have +2 Power." },
      { name: "Rock Slide", cost: 4, power: 6, series: 3, ability: "On Reveal: Shuffle 2 Rocks into your opponent's deck." },
      { name: "Rogue", cost: 3, power: 1, series: 3, ability: "On Reveal: Steal an Ongoing ability from an enemy card here." },
      { name: "Ronan The Accuser", cost: 5, power: 3, series: 3, ability: "Ongoing: +2 Power for each card in your opponent's hand." },
      { name: "Sera", cost: 5, power: 4, series: 3, ability: "Ongoing: Cards in your hand cost 1 less. (minimum 1)" },
      { name: "Shadow King", cost: 4, power: 3, series: 3, ability: "On Reveal: Set all cards here to their base Power." },
      { name: "She-Hulk", cost: 6, power: 10, series: 3, ability: "Costs 1 less for each unspent Energy last turn." },
      { name: "Silver Surfer", cost: 3, power: 0, series: 3, ability: "On Reveal: Give your other 3-Cost cards +3 Power." },
      { name: "Spider-Man", cost: 4, power: 3, series: 3, ability: "On Reveal: Your opponent can't play cards at this location next turn." },
      { name: "Super-Skrull", cost: 4, power: 2, series: 3, ability: "Ongoing: Has the Ongoing abilities of all enemy cards." },
      { name: "Taskmaster", cost: 5, power: 0, series: 3, ability: "On Reveal: Set this card's Power equal to the Power of the last card you played." },
      { name: "Titania", cost: 1, power: 5, series: 3, ability: "When ANY card is played at this location, this card switches sides." },
      { name: "Typhoid Mary", cost: 4, power: 10, series: 3, ability: "Ongoing: Your other cards have -1 Power." },
      { name: "Ultron", cost: 6, power: 8, series: 3, ability: "On Reveal: Create 4 Drones at each other location." },
      { name: "Venom", cost: 3, power: 1, series: 3, ability: "On Reveal: Destroy your other cards at this location. Add their Power to this card." },
      { name: "Viper", cost: 2, power: 3, series: 3, ability: "On Reveal: Your opponent gains control of one of your other cards at this location." },
      { name: "Vision", cost: 5, power: 7, series: 3, ability: "You can move this each turn." },
      { name: "Wasp", cost: 0, power: 1, series: 3, ability: "No ability." },
      { name: "Wave", cost: 3, power: 3, series: 3, ability: "On Reveal: All cards cost 4 until the end of next turn." },
      { name: "Wong", cost: 4, power: 2, series: 3, ability: "Ongoing: Your On Reveal abilities at this location happen twice." },
      { name: "Yellow Jacket", cost: 0, power: 2, series: 3, ability: "On Reveal: Afflict your other cards at this location with -1 Power." },
      { name: "Zabu", cost: 3, power: 2, series: 3, ability: "Ongoing: Your 4-Cost cards cost 2 less. (minimum 1)" },
      { name: "Zero", cost: 1, power: 3, series: 3, ability: "On Reveal: Remove the abilities on the next card you play." },

      // Series 4 Cards (Popular ones)
      { name: "Attuma", cost: 4, power: 10, series: 4, ability: "If you have another card here at the end of your turn, destroy this." },
      { name: "Galactus", cost: 6, power: 3, series: 4, ability: "On Reveal: If this is your only card here, destroy all other locations." },
      { name: "High Evolutionary", cost: 4, power: 4, series: 4, ability: "At the start of the game, unlock the abilities of your cards with no abilities." },
      { name: "Kitty Pryde", cost: 1, power: 0, series: 4, ability: "You can return this to your hand to gain +2 Power." },
      { name: "M'Baku", cost: 1, power: 2, series: 4, ability: "If this is in your deck at the end of the game, it jumps to a random location." },
      { name: "Negasonic", cost: 3, power: 4, series: 4, ability: "When ANY card is played here, destroy this card AND that card." },
      { name: "Orka", cost: 6, power: 9, series: 4, ability: "Ongoing: +5 Power if this is your only card here." },
      { name: "Shanna", cost: 4, power: 2, series: 4, ability: "On Reveal: Add a random 1-Cost card to each location." },
      { name: "Shuri", cost: 4, power: 2, series: 4, ability: "On Reveal: Double the Power of the next card you play." },
      { name: "Super Skrull", cost: 4, power: 2, series: 4, ability: "Ongoing: Has the Ongoing effects of all enemy cards." },
      { name: "The Hood", cost: 1, power: -2, series: 4, ability: "On Reveal: Add Demon to your hand." },
      { name: "Thanos", cost: 6, power: 8, series: 4, ability: "At the start of the game, shuffle the six Infinity Stones into your deck." },

      // Series 5 Cards (Popular ones)
      { name: "Darkhawk", cost: 4, power: 1, series: 5, ability: "Ongoing: +2 Power for each card in your opponent's deck." },
      { name: "Galactus", cost: 6, power: 3, series: 5, ability: "On Reveal: If this is your only card here, destroy all other locations." },
      { name: "Kang", cost: 5, power: 0, series: 5, ability: "On Reveal: Look at what your opponent did, then restart the turn." },
      { name: "Knull", cost: 6, power: 0, series: 5, ability: "Ongoing: Has the combined Power of all cards destroyed this game." },
      { name: "Thanos", cost: 6, power: 8, series: 5, ability: "At the start of the game, shuffle the six Infinity Stones into your deck." }
    ];

    // Remove duplicates (some cards appear in multiple series in different versions)
    const uniqueCards = CARD_DATA.reduce((acc, card) => {
      if (!acc.find(c => c.name === card.name)) {
        acc.push(card);
      }
      return acc;
    }, []);

    // ==================== UTILITY FUNCTIONS ====================
    const getSeriesColor = (series) => {
      const colors = {
        1: 'series-1',
        2: 'series-2',
        3: 'series-3',
        4: 'series-4',
        5: 'series-5',
        'spotlight': 'spotlight'
      };
      return colors[series] || 'series-1';
    };

    const getSeriesBorderClass = (series) => {
      return `series-border-${series}`;
    };

    // localStorage helpers
    const loadFromStorage = (key, defaultValue) => {
      try {
        const stored = localStorage.getItem(key);
        return stored ? JSON.parse(stored) : defaultValue;
      } catch {
        return defaultValue;
      }
    };

    const saveToStorage = (key, value) => {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {
        console.warn('Failed to save to localStorage:', e);
      }
    };

    // Generate UUID
    const generateId = () => {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    };

    // Format date
    const formatDate = (dateString) => {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    };

    // ==================== COMPONENTS ====================

    // Navigation Bar
    const NavBar = ({ activeTab, setActiveTab }) => {
      const tabs = [
        { id: 'dashboard', label: 'Home', icon: '‚ö°' },
        { id: 'collection', label: 'Cards', icon: 'üÉè' },
        { id: 'history', label: 'Stats', icon: 'üìä' },
        { id: 'calculator', label: 'Calc', icon: 'üéØ' },
        { id: 'settings', label: 'Config', icon: '‚öôÔ∏è' }
      ];

      return (
        <nav className="fixed bottom-0 left-0 right-0 bg-marvel-black border-t-4 border-marvel-red z-50">
          <div className="flex justify-around items-center h-16 max-w-lg mx-auto">
            {tabs.map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`flex flex-col items-center justify-center w-full h-full transition-colors ${
                  activeTab === tab.id
                    ? 'text-marvel-red tab-active'
                    : 'text-gray-400 hover:text-white'
                }`}
              >
                <span className="text-xl">{tab.icon}</span>
                <span className="text-xs mt-1 font-medium">{tab.label}</span>
              </button>
            ))}
          </div>
        </nav>
      );
    };

    // Header
    const Header = ({ title }) => (
      <header className="bg-marvel-red halftone py-4 px-4 shadow-comic mb-4">
        <h1 className="text-2xl font-comic text-white text-center tracking-wider">
          {title}
        </h1>
      </header>
    );

    // Dashboard Component
    const Dashboard = ({ collection, matches, onQuickMatch }) => {
      const totalCards = uniqueCards.length;
      const ownedCount = collection.owned.length;
      const completionPercent = Math.round((ownedCount / totalCards) * 100);

      // Calculate stats
      const today = new Date().toDateString();
      const todayMatches = matches.filter(m => new Date(m.timestamp).toDateString() === today);
      const todayWins = todayMatches.filter(m => m.result === 'WIN').length;
      const todayCubes = todayMatches.reduce((sum, m) => sum + (m.result === 'WIN' ? m.cubes : -m.cubes), 0);

      const totalWins = matches.filter(m => m.result === 'WIN').length;
      const totalGames = matches.length;
      const winRate = totalGames > 0 ? Math.round((totalWins / totalGames) * 100) : 0;
      const netCubes = matches.reduce((sum, m) => sum + (m.result === 'WIN' ? m.cubes : -m.cubes), 0);

      // Current streak
      const getStreak = () => {
        if (matches.length === 0) return { count: 0, type: 'none' };
        const sorted = [...matches].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        const firstResult = sorted[0].result;
        let count = 0;
        for (const match of sorted) {
          if (match.result === firstResult) count++;
          else break;
        }
        return { count, type: firstResult };
      };
      const streak = getStreak();

      return (
        <div className="px-4 pb-20">
          <Header title="SNAPAPOULOUS PRIME" />

          {/* Quick Stats */}
          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="bg-gray-800 rounded-lg p-3 border-l-4 border-marvel-red panel-border">
              <div className="text-gray-400 text-xs uppercase">Collection</div>
              <div className="text-2xl font-comic text-white">{completionPercent}%</div>
              <div className="text-sm text-gray-400">{ownedCount}/{totalCards} cards</div>
            </div>
            <div className="bg-gray-800 rounded-lg p-3 border-l-4 border-marvel-gold panel-border">
              <div className="text-gray-400 text-xs uppercase">Win Rate</div>
              <div className="text-2xl font-comic text-white">{winRate}%</div>
              <div className="text-sm text-gray-400">{totalWins}/{totalGames} games</div>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="bg-gray-800 rounded-lg p-3 border-l-4 border-marvel-blue panel-border">
              <div className="text-gray-400 text-xs uppercase">Net Cubes</div>
              <div className={`text-2xl font-comic ${netCubes >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {netCubes >= 0 ? '+' : ''}{netCubes}
              </div>
              <div className="text-sm text-gray-400">
                Today: {todayCubes >= 0 ? '+' : ''}{todayCubes}
              </div>
            </div>
            <div className="bg-gray-800 rounded-lg p-3 border-l-4 border-series-3 panel-border">
              <div className="text-gray-400 text-xs uppercase">Streak</div>
              <div className={`text-2xl font-comic ${streak.type === 'WIN' ? 'text-green-400' : streak.type === 'LOSS' ? 'text-red-400' : 'text-gray-400'}`}>
                {streak.count} {streak.type === 'WIN' ? 'W' : streak.type === 'LOSS' ? 'L' : '-'}
              </div>
              <div className="text-sm text-gray-400">Current</div>
            </div>
          </div>

          {/* Quick Match Entry */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <h2 className="text-lg font-comic text-marvel-gold mb-3">Quick Match</h2>

            <div className="mb-3">
              <div className="text-sm text-green-400 mb-2">WIN</div>
              <div className="flex gap-2">
                {[1, 2, 4, 8].map(cubes => (
                  <button
                    key={`win-${cubes}`}
                    onClick={() => onQuickMatch('WIN', cubes)}
                    className="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded shadow-comic-sm active:shadow-none active:translate-x-0.5 active:translate-y-0.5 transition-all"
                  >
                    +{cubes}
                  </button>
                ))}
              </div>
            </div>

            <div>
              <div className="text-sm text-red-400 mb-2">LOSS</div>
              <div className="flex gap-2">
                {[1, 2, 4, 8].map(cubes => (
                  <button
                    key={`loss-${cubes}`}
                    onClick={() => onQuickMatch('LOSS', cubes)}
                    className="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded shadow-comic-sm active:shadow-none active:translate-x-0.5 active:translate-y-0.5 transition-all"
                  >
                    -{cubes}
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* Recent Matches */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border">
            <h2 className="text-lg font-comic text-marvel-gold mb-3">Recent Matches</h2>
            {matches.length === 0 ? (
              <p className="text-gray-400 text-center py-4">No matches recorded yet</p>
            ) : (
              <div className="space-y-2 max-h-48 overflow-y-auto">
                {[...matches].reverse().slice(0, 5).map(match => (
                  <div
                    key={match.id}
                    className={`flex items-center justify-between p-2 rounded ${
                      match.result === 'WIN' ? 'bg-green-900/30' : 'bg-red-900/30'
                    }`}
                  >
                    <span className={`font-bold ${match.result === 'WIN' ? 'text-green-400' : 'text-red-400'}`}>
                      {match.result === 'WIN' ? '+' : '-'}{match.cubes} cubes
                    </span>
                    <span className="text-gray-400 text-sm">{formatDate(match.timestamp)}</span>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // Collection Component
    const Collection = ({ collection, setCollection }) => {
      const [search, setSearch] = useState('');
      const [seriesFilter, setSeriesFilter] = useState('all');
      const [ownedFilter, setOwnedFilter] = useState('all');

      const filteredCards = useMemo(() => {
        return uniqueCards.filter(card => {
          // Search filter
          if (search && !card.name.toLowerCase().includes(search.toLowerCase())) {
            return false;
          }
          // Series filter
          if (seriesFilter !== 'all' && card.series !== parseInt(seriesFilter)) {
            return false;
          }
          // Owned filter
          const isOwned = collection.owned.includes(card.name);
          if (ownedFilter === 'owned' && !isOwned) return false;
          if (ownedFilter === 'missing' && isOwned) return false;

          return true;
        });
      }, [search, seriesFilter, ownedFilter, collection.owned]);

      const toggleCard = (cardName) => {
        setCollection(prev => {
          const isOwned = prev.owned.includes(cardName);
          const newOwned = isOwned
            ? prev.owned.filter(c => c !== cardName)
            : [...prev.owned, cardName];
          return {
            owned: newOwned,
            lastUpdated: new Date().toISOString()
          };
        });
      };

      const markAllSeries = (series) => {
        const seriesCards = uniqueCards.filter(c => c.series === series).map(c => c.name);
        setCollection(prev => {
          const newOwned = [...new Set([...prev.owned, ...seriesCards])];
          return { owned: newOwned, lastUpdated: new Date().toISOString() };
        });
      };

      const clearCollection = () => {
        if (confirm('Clear all owned cards?')) {
          setCollection({ owned: [], lastUpdated: new Date().toISOString() });
        }
      };

      const completionPercent = Math.round((collection.owned.length / uniqueCards.length) * 100);

      return (
        <div className="px-4 pb-20">
          <Header title="COLLECTION" />

          {/* Completion Bar */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <div className="flex justify-between mb-2">
              <span className="text-white font-medium">Completion</span>
              <span className="text-marvel-gold font-bold">{completionPercent}%</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
              <div
                className="bg-gradient-to-r from-marvel-red to-marvel-gold h-full transition-all duration-500"
                style={{ width: `${completionPercent}%` }}
              />
            </div>
            <div className="text-center text-sm text-gray-400 mt-2">
              {collection.owned.length} / {uniqueCards.length} cards owned
            </div>
          </div>

          {/* Filters */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            {/* Search */}
            <input
              type="text"
              placeholder="Search cards..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="w-full bg-gray-700 text-white rounded px-3 py-2 mb-3 border-2 border-gray-600 focus:border-marvel-red focus:outline-none"
            />

            <div className="flex gap-2 mb-3">
              {/* Series Filter */}
              <select
                value={seriesFilter}
                onChange={(e) => setSeriesFilter(e.target.value)}
                className="flex-1 bg-gray-700 text-white rounded px-2 py-2 border-2 border-gray-600 focus:border-marvel-red focus:outline-none"
              >
                <option value="all">All Series</option>
                <option value="1">Series 1</option>
                <option value="2">Series 2</option>
                <option value="3">Series 3</option>
                <option value="4">Series 4</option>
                <option value="5">Series 5</option>
              </select>

              {/* Owned Filter */}
              <select
                value={ownedFilter}
                onChange={(e) => setOwnedFilter(e.target.value)}
                className="flex-1 bg-gray-700 text-white rounded px-2 py-2 border-2 border-gray-600 focus:border-marvel-red focus:outline-none"
              >
                <option value="all">All Cards</option>
                <option value="owned">Owned</option>
                <option value="missing">Missing</option>
              </select>
            </div>

            {/* Bulk Actions */}
            <div className="flex gap-2 flex-wrap">
              <button
                onClick={() => markAllSeries(1)}
                className="bg-series-1 text-white text-xs px-2 py-1 rounded hover:opacity-80"
              >
                Own S1
              </button>
              <button
                onClick={() => markAllSeries(2)}
                className="bg-series-2 text-white text-xs px-2 py-1 rounded hover:opacity-80"
              >
                Own S2
              </button>
              <button
                onClick={clearCollection}
                className="bg-red-600 text-white text-xs px-2 py-1 rounded hover:opacity-80 ml-auto"
              >
                Clear All
              </button>
            </div>
          </div>

          {/* Cards Grid */}
          <div className="grid grid-cols-3 sm:grid-cols-4 gap-2">
            {filteredCards.map(card => {
              const isOwned = collection.owned.includes(card.name);
              return (
                <button
                  key={card.name}
                  onClick={() => toggleCard(card.name)}
                  className={`
                    relative p-2 rounded-lg border-3 transition-all card-hover
                    ${getSeriesBorderClass(card.series)}
                    ${isOwned
                      ? 'bg-gray-700 border-opacity-100'
                      : 'bg-gray-900 border-opacity-30 opacity-50'
                    }
                  `}
                  style={{ borderWidth: '3px' }}
                >
                  {/* Cost Badge */}
                  <div className="absolute top-1 left-1 w-5 h-5 bg-marvel-blue rounded-full flex items-center justify-center text-xs font-bold text-white">
                    {card.cost}
                  </div>

                  {/* Power Badge */}
                  <div className="absolute top-1 right-1 w-5 h-5 bg-marvel-red rounded-full flex items-center justify-center text-xs font-bold text-white">
                    {card.power}
                  </div>

                  {/* Card Name */}
                  <div className="mt-6 text-xs text-white text-center truncate">
                    {card.name}
                  </div>

                  {/* Owned Checkmark */}
                  {isOwned && (
                    <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center">
                      <span className="text-white text-xs">‚úì</span>
                    </div>
                  )}
                </button>
              );
            })}
          </div>

          {filteredCards.length === 0 && (
            <div className="text-center text-gray-400 py-8">
              No cards found matching your filters
            </div>
          )}
        </div>
      );
    };

    // Match History Component
    const History = ({ matches, setMatches }) => {
      const [filter, setFilter] = useState('all');
      const [showAddModal, setShowAddModal] = useState(false);

      // Stats calculation
      const stats = useMemo(() => {
        const now = new Date();
        const today = now.toDateString();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

        const todayMatches = matches.filter(m => new Date(m.timestamp).toDateString() === today);
        const weekMatches = matches.filter(m => new Date(m.timestamp) >= weekAgo);

        const calcStats = (matchList) => {
          const wins = matchList.filter(m => m.result === 'WIN').length;
          const total = matchList.length;
          const cubes = matchList.reduce((sum, m) => sum + (m.result === 'WIN' ? m.cubes : -m.cubes), 0);
          const winRate = total > 0 ? Math.round((wins / total) * 100) : 0;
          const cubeRate = total > 0 ? (cubes / total).toFixed(2) : 0;
          return { wins, total, cubes, winRate, cubeRate };
        };

        return {
          all: calcStats(matches),
          today: calcStats(todayMatches),
          week: calcStats(weekMatches)
        };
      }, [matches]);

      const filteredMatches = useMemo(() => {
        if (filter === 'all') return matches;
        return matches.filter(m => m.result === filter);
      }, [matches, filter]);

      const deleteMatch = (id) => {
        if (confirm('Delete this match?')) {
          setMatches(prev => prev.filter(m => m.id !== id));
        }
      };

      const exportData = () => {
        const dataStr = JSON.stringify(matches, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `snap-matches-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      return (
        <div className="px-4 pb-20">
          <Header title="MATCH HISTORY" />

          {/* Stats Cards */}
          <div className="grid grid-cols-3 gap-2 mb-4">
            <div className="bg-gray-800 rounded-lg p-3 panel-border">
              <div className="text-gray-400 text-xs uppercase mb-1">All Time</div>
              <div className="text-lg font-bold text-white">{stats.all.winRate}%</div>
              <div className="text-xs text-gray-400">{stats.all.wins}/{stats.all.total}</div>
              <div className={`text-sm font-bold ${stats.all.cubes >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {stats.all.cubes >= 0 ? '+' : ''}{stats.all.cubes}
              </div>
            </div>
            <div className="bg-gray-800 rounded-lg p-3 panel-border">
              <div className="text-gray-400 text-xs uppercase mb-1">This Week</div>
              <div className="text-lg font-bold text-white">{stats.week.winRate}%</div>
              <div className="text-xs text-gray-400">{stats.week.wins}/{stats.week.total}</div>
              <div className={`text-sm font-bold ${stats.week.cubes >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {stats.week.cubes >= 0 ? '+' : ''}{stats.week.cubes}
              </div>
            </div>
            <div className="bg-gray-800 rounded-lg p-3 panel-border">
              <div className="text-gray-400 text-xs uppercase mb-1">Today</div>
              <div className="text-lg font-bold text-white">{stats.today.winRate}%</div>
              <div className="text-xs text-gray-400">{stats.today.wins}/{stats.today.total}</div>
              <div className={`text-sm font-bold ${stats.today.cubes >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {stats.today.cubes >= 0 ? '+' : ''}{stats.today.cubes}
              </div>
            </div>
          </div>

          {/* Cube Rate */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <div className="flex justify-between items-center">
              <div>
                <div className="text-gray-400 text-xs uppercase">Cube Rate</div>
                <div className="text-2xl font-comic text-marvel-gold">
                  {stats.all.cubeRate} cubes/game
                </div>
              </div>
              <button
                onClick={exportData}
                className="bg-marvel-blue text-white px-3 py-2 rounded text-sm hover:bg-blue-600 shadow-comic-sm"
              >
                Export
              </button>
            </div>
          </div>

          {/* Filter */}
          <div className="flex gap-2 mb-4">
            {['all', 'WIN', 'LOSS'].map(f => (
              <button
                key={f}
                onClick={() => setFilter(f)}
                className={`flex-1 py-2 rounded font-medium transition-colors ${
                  filter === f
                    ? 'bg-marvel-red text-white'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`}
              >
                {f === 'all' ? 'All' : f === 'WIN' ? 'Wins' : 'Losses'}
              </button>
            ))}
          </div>

          {/* Match List */}
          <div className="space-y-2">
            {filteredMatches.length === 0 ? (
              <div className="text-center text-gray-400 py-8">
                No matches recorded yet
              </div>
            ) : (
              [...filteredMatches].reverse().map(match => (
                <div
                  key={match.id}
                  className={`bg-gray-800 rounded-lg p-3 panel-border ${
                    match.result === 'WIN' ? 'border-l-4 border-l-green-500' : 'border-l-4 border-l-red-500'
                  }`}
                >
                  <div className="flex justify-between items-center">
                    <div>
                      <div className={`text-lg font-bold ${
                        match.result === 'WIN' ? 'text-green-400' : 'text-red-400'
                      }`}>
                        {match.result === 'WIN' ? '+' : '-'}{match.cubes} Cubes
                      </div>
                      <div className="text-sm text-gray-400">
                        {formatDate(match.timestamp)}
                      </div>
                      {match.deck && (
                        <div className="text-xs text-marvel-blue">{match.deck}</div>
                      )}
                    </div>
                    <button
                      onClick={() => deleteMatch(match.id)}
                      className="text-gray-500 hover:text-red-400 p-2"
                    >
                      ‚úï
                    </button>
                  </div>
                  {match.notes && (
                    <div className="mt-2 text-sm text-gray-400 italic">
                      "{match.notes}"
                    </div>
                  )}
                </div>
              ))
            )}
          </div>
        </div>
      );
    };

    // Snap Calculator Component
    const Calculator = () => {
      const [turn, setTurn] = useState(4);
      const [confidence, setConfidence] = useState(50);
      const [cardsToDraw, setCardsToDraw] = useState(1);
      const [copiesInDeck, setCopiesInDeck] = useState(1);

      // Cards drawn by turn
      const cardsDrawnByTurn = (t) => Math.min(12, 3 + t);
      const cardsSeen = cardsDrawnByTurn(turn);

      // Hypergeometric probability
      const hypergeometric = (N, K, n, k) => {
        // P(X >= k) where N=deck size, K=copies wanted, n=draws, k=success needed
        // For "at least 1", k=1
        // P(X >= 1) = 1 - P(X = 0)
        // P(X = 0) = C(K,0) * C(N-K, n) / C(N, n) = C(N-K, n) / C(N, n)

        const factorial = (num) => {
          if (num <= 1) return 1;
          let result = 1;
          for (let i = 2; i <= num; i++) result *= i;
          return result;
        };

        const combination = (a, b) => {
          if (b > a) return 0;
          if (b === 0 || b === a) return 1;
          return factorial(a) / (factorial(b) * factorial(a - b));
        };

        const pZero = combination(N - K, n) / combination(N, n);
        return 1 - pZero;
      };

      const drawProbability = hypergeometric(12, copiesInDeck, cardsToDraw, 1) * 100;

      // Snap recommendation based on confidence and turn
      const getRecommendation = () => {
        // Risk increases later in game due to higher cube stakes
        const turnRiskFactor = turn <= 3 ? 0.9 : turn <= 5 ? 1.0 : 1.1;
        const adjustedConfidence = confidence / turnRiskFactor;

        if (adjustedConfidence >= 70) {
          return { action: 'SNAP', color: 'text-green-400', bgColor: 'bg-green-600', animate: true };
        } else if (adjustedConfidence >= 45) {
          return { action: 'HOLD', color: 'text-yellow-400', bgColor: 'bg-yellow-600', animate: false };
        } else {
          return { action: 'RETREAT', color: 'text-red-400', bgColor: 'bg-red-600', animate: false };
        }
      };

      const recommendation = getRecommendation();

      return (
        <div className="px-4 pb-20">
          <Header title="SNAP CALCULATOR" />

          {/* Recommendation Display */}
          <div className={`${recommendation.bgColor} rounded-lg p-6 panel-border mb-4 text-center ${recommendation.animate ? 'pulse-snap' : ''}`}>
            <div className="text-4xl font-comic text-white mb-2">
              {recommendation.action}
            </div>
            <div className="text-white/80">
              {recommendation.action === 'SNAP' && 'The odds favor you. Make your move!'}
              {recommendation.action === 'HOLD' && 'Wait for more information before committing.'}
              {recommendation.action === 'RETREAT' && 'Live to fight another match. Save your cubes.'}
            </div>
          </div>

          {/* Turn Selector */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <div className="flex justify-between items-center mb-2">
              <span className="text-white font-medium">Current Turn</span>
              <span className="text-marvel-gold font-bold text-xl">{turn}</span>
            </div>
            <input
              type="range"
              min="1"
              max="7"
              value={turn}
              onChange={(e) => setTurn(parseInt(e.target.value))}
              className="w-full"
            />
            <div className="flex justify-between text-xs text-gray-400 mt-1">
              <span>1</span>
              <span>2</span>
              <span>3</span>
              <span>4</span>
              <span>5</span>
              <span>6</span>
              <span>7</span>
            </div>
            <div className="text-center text-sm text-gray-400 mt-2">
              Cards seen: {cardsSeen}/12
            </div>
          </div>

          {/* Win Confidence */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <div className="flex justify-between items-center mb-2">
              <span className="text-white font-medium">Win Confidence</span>
              <span className={`font-bold text-xl ${
                confidence >= 70 ? 'text-green-400' : confidence >= 45 ? 'text-yellow-400' : 'text-red-400'
              }`}>{confidence}%</span>
            </div>
            <input
              type="range"
              min="0"
              max="100"
              value={confidence}
              onChange={(e) => setConfidence(parseInt(e.target.value))}
              className="w-full"
            />
            <div className="flex justify-between text-xs text-gray-400 mt-1">
              <span>0%</span>
              <span>50%</span>
              <span>100%</span>
            </div>
          </div>

          {/* Draw Probability Calculator */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border">
            <h3 className="text-lg font-comic text-marvel-gold mb-3">Draw Probability</h3>

            <div className="grid grid-cols-2 gap-3 mb-4">
              <div>
                <label className="text-sm text-gray-400">Cards to Draw</label>
                <input
                  type="number"
                  min="1"
                  max="12"
                  value={cardsToDraw}
                  onChange={(e) => setCardsToDraw(Math.max(1, Math.min(12, parseInt(e.target.value) || 1)))}
                  className="w-full bg-gray-700 text-white rounded px-3 py-2 mt-1 border-2 border-gray-600 focus:border-marvel-red focus:outline-none"
                />
              </div>
              <div>
                <label className="text-sm text-gray-400">Copies in Deck</label>
                <input
                  type="number"
                  min="1"
                  max="4"
                  value={copiesInDeck}
                  onChange={(e) => setCopiesInDeck(Math.max(1, Math.min(4, parseInt(e.target.value) || 1)))}
                  className="w-full bg-gray-700 text-white rounded px-3 py-2 mt-1 border-2 border-gray-600 focus:border-marvel-red focus:outline-none"
                />
              </div>
            </div>

            <div className="bg-gray-700 rounded-lg p-4 text-center">
              <div className="text-gray-400 text-sm mb-1">
                Probability of drawing at least 1 copy:
              </div>
              <div className={`text-3xl font-comic ${
                drawProbability >= 70 ? 'text-green-400' : drawProbability >= 40 ? 'text-yellow-400' : 'text-red-400'
              }`}>
                {drawProbability.toFixed(1)}%
              </div>
            </div>

            {/* Quick Reference */}
            <div className="mt-4 text-xs text-gray-400">
              <div className="font-medium text-gray-300 mb-2">Quick Reference (1 copy in deck):</div>
              <div className="grid grid-cols-2 gap-1">
                <span>Turn 1 (4 cards): 33%</span>
                <span>Turn 2 (5 cards): 42%</span>
                <span>Turn 3 (6 cards): 50%</span>
                <span>Turn 4 (7 cards): 58%</span>
                <span>Turn 5 (8 cards): 67%</span>
                <span>Turn 6 (9 cards): 75%</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Settings Component
    const Settings = ({ settings, setSettings, collection, matches, setCollection, setMatches }) => {
      const [showImport, setShowImport] = useState(false);
      const [importData, setImportData] = useState('');

      const handleExport = (type) => {
        let data;
        let filename;

        if (type === 'all') {
          data = { collection, matches, settings };
          filename = `snapapoulous-backup-${new Date().toISOString().split('T')[0]}.json`;
        } else if (type === 'collection') {
          data = collection;
          filename = `snap-collection-${new Date().toISOString().split('T')[0]}.json`;
        } else {
          data = matches;
          filename = `snap-matches-${new Date().toISOString().split('T')[0]}.json`;
        }

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
      };

      const handleImport = () => {
        try {
          const data = JSON.parse(importData);

          if (data.collection && data.matches) {
            // Full backup
            setCollection(data.collection);
            setMatches(data.matches);
            if (data.settings) setSettings(data.settings);
            alert('Data imported successfully!');
          } else if (data.owned) {
            // Collection only
            setCollection(data);
            alert('Collection imported successfully!');
          } else if (Array.isArray(data)) {
            // Matches only
            setMatches(data);
            alert('Matches imported successfully!');
          } else {
            alert('Unrecognized data format');
          }

          setShowImport(false);
          setImportData('');
        } catch (e) {
          alert('Invalid JSON data');
        }
      };

      const clearAllData = () => {
        if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
          setCollection({ owned: [], lastUpdated: new Date().toISOString() });
          setMatches([]);
          setSettings({ theme: 'dark' });
          localStorage.clear();
          alert('All data cleared');
        }
      };

      return (
        <div className="px-4 pb-20">
          <Header title="SETTINGS" />

          {/* App Info */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <div className="flex items-center gap-3 mb-3">
              <div className="w-12 h-12 bg-marvel-red rounded-lg flex items-center justify-center">
                <span className="text-2xl font-comic text-white">S</span>
              </div>
              <div>
                <div className="text-white font-bold">Snapapoulous Prime</div>
                <div className="text-gray-400 text-sm">v1.0.0 - Phase 1</div>
              </div>
            </div>
            <p className="text-gray-400 text-sm">
              Your Marvel Snap companion app. Track your collection, log matches, and calculate probabilities.
            </p>
          </div>

          {/* Data Stats */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <h3 className="text-lg font-comic text-marvel-gold mb-3">Your Data</h3>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <div className="text-gray-400 text-sm">Collection</div>
                <div className="text-white font-bold">{collection.owned.length} cards</div>
              </div>
              <div>
                <div className="text-gray-400 text-sm">Matches</div>
                <div className="text-white font-bold">{matches.length} games</div>
              </div>
            </div>
          </div>

          {/* Export */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <h3 className="text-lg font-comic text-marvel-gold mb-3">Export Data</h3>
            <div className="grid grid-cols-3 gap-2">
              <button
                onClick={() => handleExport('all')}
                className="bg-marvel-blue text-white py-2 rounded text-sm hover:bg-blue-600 shadow-comic-sm"
              >
                All Data
              </button>
              <button
                onClick={() => handleExport('collection')}
                className="bg-series-3 text-white py-2 rounded text-sm hover:opacity-80 shadow-comic-sm"
              >
                Collection
              </button>
              <button
                onClick={() => handleExport('matches')}
                className="bg-series-2 text-white py-2 rounded text-sm hover:opacity-80 shadow-comic-sm"
              >
                Matches
              </button>
            </div>
          </div>

          {/* Import */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mb-4">
            <h3 className="text-lg font-comic text-marvel-gold mb-3">Import Data</h3>
            {!showImport ? (
              <button
                onClick={() => setShowImport(true)}
                className="w-full bg-gray-700 text-white py-2 rounded hover:bg-gray-600"
              >
                Import from JSON
              </button>
            ) : (
              <div className="space-y-2">
                <textarea
                  value={importData}
                  onChange={(e) => setImportData(e.target.value)}
                  placeholder="Paste JSON data here..."
                  className="w-full h-32 bg-gray-700 text-white rounded px-3 py-2 border-2 border-gray-600 focus:border-marvel-red focus:outline-none text-sm"
                />
                <div className="flex gap-2">
                  <button
                    onClick={handleImport}
                    className="flex-1 bg-marvel-blue text-white py-2 rounded hover:bg-blue-600"
                  >
                    Import
                  </button>
                  <button
                    onClick={() => { setShowImport(false); setImportData(''); }}
                    className="flex-1 bg-gray-600 text-white py-2 rounded hover:bg-gray-500"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Danger Zone */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border border-red-500/50">
            <h3 className="text-lg font-comic text-red-400 mb-3">Danger Zone</h3>
            <button
              onClick={clearAllData}
              className="w-full bg-red-600 text-white py-2 rounded hover:bg-red-500 shadow-comic-sm"
            >
              Clear All Data
            </button>
            <p className="text-gray-400 text-xs mt-2 text-center">
              This will permanently delete all your collection and match data.
            </p>
          </div>

          {/* Phase 2 Preview */}
          <div className="bg-gray-800 rounded-lg p-4 panel-border mt-4 border-marvel-gold/30">
            <h3 className="text-lg font-comic text-marvel-gold mb-2">Coming Soon...</h3>
            <ul className="text-gray-400 text-sm space-y-1">
              <li>- AI Advisor (Snapapoulous persona)</li>
              <li>- Google OAuth for Gemini AI</li>
              <li>- Multiple AI provider support</li>
              <li>- Deck building assistance</li>
              <li>- Meta matchup coaching</li>
            </ul>
          </div>
        </div>
      );
    };

    // ==================== MAIN APP ====================
    const App = () => {
      const [activeTab, setActiveTab] = useState('dashboard');

      // Load state from localStorage
      const [collection, setCollection] = useState(() =>
        loadFromStorage('snap_collection', { owned: [], lastUpdated: new Date().toISOString() })
      );

      const [matches, setMatches] = useState(() =>
        loadFromStorage('snap_matches', [])
      );

      const [settings, setSettings] = useState(() =>
        loadFromStorage('snap_settings', { theme: 'dark' })
      );

      // Save to localStorage on changes
      useEffect(() => {
        saveToStorage('snap_collection', collection);
      }, [collection]);

      useEffect(() => {
        saveToStorage('snap_matches', matches);
      }, [matches]);

      useEffect(() => {
        saveToStorage('snap_settings', settings);
      }, [settings]);

      // Quick match handler
      const handleQuickMatch = (result, cubes) => {
        const newMatch = {
          id: generateId(),
          timestamp: new Date().toISOString(),
          result,
          cubes,
          opponent: '',
          deck: '',
          notes: '',
          snapped: 'NONE'
        };
        setMatches(prev => [...prev, newMatch]);
      };

      // Register service worker
      useEffect(() => {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('Service Worker registered:', reg.scope))
            .catch(err => console.error('Service Worker registration failed:', err));
        }
      }, []);

      return (
        <div className="min-h-screen bg-marvel-black">
          {activeTab === 'dashboard' && (
            <Dashboard
              collection={collection}
              matches={matches}
              onQuickMatch={handleQuickMatch}
            />
          )}
          {activeTab === 'collection' && (
            <Collection
              collection={collection}
              setCollection={setCollection}
            />
          )}
          {activeTab === 'history' && (
            <History
              matches={matches}
              setMatches={setMatches}
            />
          )}
          {activeTab === 'calculator' && (
            <Calculator />
          )}
          {activeTab === 'settings' && (
            <Settings
              settings={settings}
              setSettings={setSettings}
              collection={collection}
              matches={matches}
              setCollection={setCollection}
              setMatches={setMatches}
            />
          )}

          <NavBar activeTab={activeTab} setActiveTab={setActiveTab} />
        </div>
      );
    };

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
